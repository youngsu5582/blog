---
title: "ì™¸ë¶€(ê¹ƒí—ˆë¸Œ) í˜¸ì¶œì„ ë¹„ë™ê¸°ë¡œ 30% ê°€ëŸ‰ ë¹ ë¥´ê²Œ(2) - ìŠ¤ë ˆë“œ íŠœë‹, ì¸¡ì •"
author: ì´ì˜ìˆ˜
date: 2024-11-09T15:56:34.506Z
tags: ['ë¹„ë™ê¸°', 'ì™¸ë¶€api', 'ìš°í…Œì½”', 'ì½”ë ˆì•„', 'ìŠ¤í”„ë§']
description: ìŠ¤ë ˆë“œ íŠœë‹ê³¼ ì„±ëŠ¥ ì¸¡ì • ë°©ë²•
image:
  path: https://velog.velcdn.com/images/dragonsu/post/ab1835c7-151a-4d97-abcf-e406d69893be/image.png
---
í•´ë‹¹ ë‚´ìš©ì€Â [í”„ë¡œì íŠ¸](https://github.com/woowacourse-teams/2024-corea)Â ì—ì„œ ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´ API í˜¸ì¶œ ì‹œê°„ì„ ì¤„ì´ê¸° ìœ„í•´ êµ¬í˜„í•˜ë©° ì‘ì„±í•œ ê¸€ì…ë‹ˆë‹¤. 
í˜¹ì‹œ, ì˜ëª»ëœ ë‚´ìš©ì´ë‚˜ ë‹¤ë¥¸ ë°©ë²•ë“±ì´ ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ë˜ëŠ”Â `joyson5582@gmail.com`ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”!


---

ì´ ë‚´ìš©ì€ [# ì™¸ë¶€(ê¹ƒí—ˆë¸Œ) í˜¸ì¶œì„ ë¹„ë™ê¸°ë¡œ 30% ê°€ëŸ‰ ë¹ ë¥´ê²Œ(1) - ê¸°ë³¸ ë¡œì§](https://velog.io/@dragonsu/%EC%99%B8%EB%B6%80%EA%B9%83%ED%97%88%EB%B8%8C-%ED%98%B8%EC%B6%9C%EC%9D%84-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%A1%9C-30-%EA%B0%80%EB%9F%89-%EB%B9%A0%EB%A5%B4%EA%B2%8C1-%EA%B8%B0%EB%B3%B8-%EB%A1%9C%EC%A7%81) ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.

```
[2024-11-09 18:45:18:12776] [ForkJoinPool.commonPool-worker-7] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-7 
[2024-11-09 18:45:18:12776] [ForkJoinPool.commonPool-worker-1] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-1 
[2024-11-09 18:45:18:12776] [ForkJoinPool.commonPool-worker-2] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-2 
[2024-11-09 18:45:18:12776] [ForkJoinPool.commonPool-worker-3] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-3 
[2024-11-09 18:45:18:12777] [ForkJoinPool.commonPool-worker-6] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-6 
[2024-11-09 18:45:18:12776] [ForkJoinPool.commonPool-worker-4] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-4 
[2024-11-09 18:45:18:12777] [ForkJoinPool.commonPool-worker-5] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-5 
[2024-11-09 18:45:18:12778] [ForkJoinPool.commonPool-worker-7] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$0:13] - Running in thread: ForkJoinPool.commonPool-worker-7 
```

`ForkJoinPool.commonPool` ì´ë¼ëŠ” ê³³ì—ì„œ ì œê³µë˜ëŠ” ê¸°ë³¸ ìŠ¤ë ˆë“œ 7ê°œë¥¼ í†µí•´ì„œ ë¹„ë™ê¸° ì‘ì—…ì´ ìˆ˜í–‰ëœ ê±¸ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
`ForkJoinPool` ì— ëŒ€í•´ì„œ ë¨¼ì € ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
## ForkJoinPool

ìë°” 7 ì—ì„œ ë„ì…ëœ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.
ëª¨ë“  í”„ë¡œì„¸ì„œ ì½”ì–´ë¥¼ ìµœëŒ€í•œ í™œìš©í•´ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ë„ì™€ì¤ë‹ˆë‹¤.

```
  ëª¨ë¸ëª…:	MacBook Air
  ëª¨ë¸ ì‹ë³„ì:	Mac14,2
  ëª¨ë¸ ë²ˆí˜¸:	Z15Y0002AKH/A
  ì¹©:	Apple M2
  ì´ ì½”ì–´ ê°œìˆ˜:	8(4 ì„±ëŠ¥ ë° 4 íš¨ìœ¨)
```

ì œê°€ ì‚¬ìš©í•˜ëŠ” ë§¥ë¶ì˜ ì½”ì–´ëŠ” ì´ 8ê°œì´ë¯€ë¡œ 7ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê±°ì˜€ë„¤ìš”!

> ì™œ ì½”ì–´ -1 ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ê°€ì§€ëŠ”ê°€?
> ì½”ì–´ 1ê°œë¥¼ ë‚¨ê²¨ë‘ë©´ ì‹œìŠ¤í…œ ì‘ì—…ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤ë ˆë“œ ê°„ì˜ ê²½ìŸì„ ì¤„ì´ê³ , ë³‘ë ¬ ì²˜ë¦¬ ì„±ëŠ¥ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> ì½”ì–´ - 1ë¡œ ì œí•œí•˜ë©´ ì‹œìŠ¤í…œì´ ë” ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•˜ë©°, ì‘ì—… ëŒ€ê¸° ì‹œê°„ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.

```java
Runtime.getRuntime().availableProcessors();  
ForkJoinPool.commonPool().getParallelism();
```

ë‘ê°œë¥¼ ì¶œë ¥í•˜ë©´ 8ê°œ, 7ê°œê°€ ë‚˜ì˜µë‹ˆë‹¤.

ì •ë§ ê°œìˆ˜ê°€ ë” ë§ìœ¼ë©´ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
>ì¶”ê°€ë¡œ ë” ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ëŒ“ê¸€ ìˆ˜ê°€ 100~200ê°œ ì‚¬ì´ì˜ ê°ê° ë‹¤ë¥¸ ëª©ë¡ë“¤ë¡œ í…ŒìŠ¤íŠ¸ í•©ë‹ˆë‹¤.

```java
private <T> void execute(String text, int count) {  
    long startTime = System.nanoTime();  
    List<CompletableFuture<T>> futures = ary.stream()  
            .map(integer -> (CompletableFuture<T>) FutureUtil.supplyAsync(() -> githubReviewProvider.provideReviewInfo("https://github.com/woowacourse-precourse/java-racingcar-6/pull/" + integer)))  
            .toList();  
    CompletableFuture<Void> allOf = CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]));  
    allOf.join(); // ëª¨ë“  ìš”ì²­ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°  
    long endTime = System.nanoTime();  
    printElapsedTime(text, endTime - startTime);  
}
```


```
ForkedJoinPool ê°œìˆ˜ : 7
ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 36 seconds, 614 milliseconds, 556 microseconds, 958 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 26 seconds, 993 milliseconds, 992 microseconds, 208 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 25 seconds, 805 milliseconds, 255 microseconds, 291 nanoseconds
```


```
ForkedJoinPool ê°œìˆ˜ : 20
ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 35 seconds, 821 milliseconds, 2 microseconds, 625 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 26 seconds, 53 milliseconds, 833 microseconds, 625 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 25 seconds, 250 milliseconds, 377 microseconds, 334 nanoseconds
```

( ì‹œê°„ ì°¨ì´ëŠ” í¬ê²Œ ì—†ëŠ”ê±¸ë¡œ ë³´ì´ë„¤ìš”. )

í•˜ì§€ë§Œ, ìœ„ ì‹¤í—˜ì€ í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
`ForkedJoinPool` ì˜ í•µì‹¬ì€ ì‘ì—…ì„ ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ(`Fork`) ë³‘ë ¬ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í•©ì¹˜ëŠ”(`Join`) ê²ƒì…ë‹ˆë‹¤.
ì¦‰, ì—¬ëŸ¬ê°œì˜ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ í•œë²ˆì— ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. - **Avoid any blocking in**Â **_ForkJoinTasks_.** [in Baeldung](https://www.baeldung.com/java-fork-join)
( `parallelStream()` ì—ì„œ ì‚¬ìš©ë˜ëŠ”ê²Œ ì´ `ForkedJoinPool` ì…ë‹ˆë‹¤. )

ê·¸ëŸ¬ë©´, ì´ëŸ° ì‘ì—…ì„ í•  ë•Œ íš¨ìœ¨ì ìœ¼ë¡œ ë¹„ë™ê¸°ë¥¼ ì²˜ë¦¬í•˜ë ¤ë©´ ë­˜ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?

## ThreadPoolExecutor
í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ì‚´í´ë³´ê¸° ì „ `ThreadPool` ë¶€í„° ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

### ThreadPool

ë³‘ë ¬ ì‘ì—…ì„ í•  ë•Œë§ˆë‹¤ ìŠ¤ë ˆë“œë¥¼ ìƒì„±&í•´ì œ í•˜ëŠ”ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.
-> ê¸°ë³¸ì ìœ¼ë¡œ, ì‹œìŠ¤í…œ ìˆ˜ì¤€ ë¦¬ì†ŒìŠ¤ì— ë§¤í•‘ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
( ë¬¼ë¡ , ìë°” 19ë¶€í„°ëŠ” `Thread.ofVirtual()` ì™€ ê°™ì´ ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ ìƒì„± ê°€ëŠ¥ì€ í•©ë‹ˆë‹¤. )

ìŠ¤ë ˆë“œ í’€ì„ í†µí•´ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ì€ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ê³  ì‚­ì œí•˜ì§€ ì•Šê³  ìœ ì§€í•´ì„œ ì‘ì—…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
ìŠ¤ë ˆë“œ í’€ì— `ë³‘ë ¬ ì‘ì—… í˜•íƒœ`ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì œì¶œí•˜ë©´ ì‘ì—…ì„ ì‹¤í–‰í•˜ê³  ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.

### ìƒì„± ë°©ë²•

ê·¸ëƒ¥ ìƒì„±ìë¥¼ í†µí•´ ìƒì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.

```java
ThreadPoolExecutor executor = new ThreadPoolExecutor(
    2, // corePoolSize
    4, // maximumPoolSize
    60, // keepAliveTime
    TimeUnit.SECONDS, // keepAliveTime ë‹¨ìœ„
    new ArrayBlockingQueue<>(10) // ì‘ì—… ëŒ€ê¸° í,
    new ThreadPoolExecutor.CallerRunsPolicy()); // ê±°ì ˆ ì‹¤í–‰ í•¸ë“¤ëŸ¬
);
```

í•´ë‹¹ ë‚´ìš©ì€ [Tomcat êµ¬í˜„í•˜ê¸° ë¯¸ì…˜](https://github.com/woowacourse/java-http/pull/760) ì—ì„œë„ í•™ìŠµí•œ ë‚´ìš©ì…ë‹ˆë‹¤.
- corePoolSize : í’€ ë‚´ ìµœì†Œë¡œ ê°€ì§€ê³  ìˆëŠ” ìŠ¤ë ˆë“œ ê°œìˆ˜ - ë¯¸ë¦¬ ì¤€ë¹„í•œ ìŠ¤ë ˆë“œë¥¼ í†µí•´ ìƒì„±ì— ë“œëŠ” ì‹œê°„ ë°©ì§€
- maximumPoolSize : ìµœëŒ€ë¡œ ê°€ì§ˆìˆ˜ ìˆëŠ” ìŠ¤ë ˆë“œ ê°œìˆ˜ - ë„ˆë¬´ ë§ì€ ìŠ¤ë ˆë“œê°€ ìƒì„±ë˜ì–´ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì°¨ì§€ í•˜ëŠ”ê±¸ ë°©ì§€
- keepAliveTime : ì‘ì—… í›„ ìŠ¤ë ˆë“œê°€ ë‚¨ì•„ìˆëŠ” ì‹œê°„ - ìŠ¤ë ˆë“œê°€ ì‚­ì œ & ìƒì„±ë˜ëŠ”ë° ë“œëŠ” ì‹œê°„ ë°©ì§€
- timeUnit : keepAliveTime ì˜ ë‹¨ìœ„
- blockingQueue : Queue ë¥¼ êµ¬í˜„í•œ ìë£Œêµ¬ì¡° - íê°€ ë¹„ì–´ ìˆê±°ë‚˜ ê°€ë“ ì°¬ ê²½ìš°, ìŠ¤ë ˆë“œë¥¼ ëŒ€ê¸° ìƒíƒœë¡œ ë§Œë“¤ì–´ì„œ ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ê¸°ëŠ¥ ì œê³µ í•´ì£¼ê¸°ì— ì‚¬ìš©
- rejectedExecutionHandler : ê±°ì ˆëœ ì‹¤í–‰ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì§€ì •í•˜ëŠ” í•¸ë“¤ëŸ¬
    - CallerRunsPolicy : Queue,Thread ê°€ ì „ë¶€ ì‘ì—… ìƒíƒœì¼ ì‹œ, Main ìŠ¤ë ˆë“œë„ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ( 10 ê°œ ì „ë¶€ ìˆ˜í–‰ )
    - AbortPolicy : ì „ë¶€ ì‘ì—… ìƒíƒœ ì‹œ, RejectedExecutionException ë°œìƒì‹œí‚´ ( 4 + 2 ê°œë§Œ ìˆ˜í–‰ )
    - DiscardPolicy : ì „ë¶€ ì‘ì—… ìƒíƒœ ì‹œ, ì¡°ìš©íˆ ì‘ì—… ê±°ë¶€ ( 4 + 2 ê°œë§Œ ìˆ˜í–‰ )
    - DiscardOldPolicy : ì „ë¶€ ì‘ì—… ìƒíƒœ ì‹œ, ì˜ˆì „ì— ëŒ€ê¸°í•˜ê³  ìˆëŠ” ì‘ì—…ì„ ì œê±° í›„ êµì²´í•œë‹¤ - current Queue ë‚´ ì‘ì—…ì´ ê³„ì† ë‹¬ë¼ì§ ( 4 +2 ê°œë§Œ ìˆ˜í–‰ )

### ExecutorService?

ìœ„ ë‚´ìš©ë“¤ê³¼ ê°™ì´ ë‚˜ì˜¤ëŠ” `ExecutorService` ê°€ ìˆìŠµë‹ˆë‹¤.
ì¸í„°í˜ì´ìŠ¤ ì´ë©°, `ThreadPoolExecutor` , `ForkJoinPool` ê°™ì€ êµ¬í˜„ì²´ë“¤ë„ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ `AbstractExecutorService`  ì˜ ìì‹ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
`Executors` ë¼ëŠ” íŒ©í† ë¦¬ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ êµ¬í˜„ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ( êµ¬ì²´ì ì¸ ì„¤ì •ì„ í•  í•„ìš” ì—†ì´ ê°„í¸í•˜ê²Œ ìƒì„±í• ë•Œ ì‚¬ìš© )

```java
public static ExecutorService newFixedThreadPool(int nThreads) {
	return new ThreadPoolExecutor(nThreads, nThreads,
								  0L, TimeUnit.MILLISECONDS,
								  new LinkedBlockingQueue<Runnable>());
}
```

```java
public static ExecutorService newCachedThreadPool() {  
    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,  
                                  60L, TimeUnit.SECONDS,  
                                  new SynchronousQueue<Runnable>());  
}
```

ì™€ ê°™ì´ í¸í•˜ê²Œ ìƒì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.
ì €í¬ëŠ” ì¢€ ë” ë³µì¡í•œ íŠœë‹ì„ ìœ„í•´ `ThreadPoolExecutor` ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
### In Spring Bean

```java
@Bean
public Executor taskExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(5);
    executor.setMaxPoolSize(10);
    executor.setQueueCapacity(25);
    executor.initialize();
    return executor;
}

===

public TaskService(@Qualifier("customExecutor") Executor customExecutor) {
	this.customExecutor = customExecutor;
}

@Async("customExecutor") // íŠ¹ì • Executor ì§€ì •
public void executeAsyncTask(int i) {
	...
}
```

ì™€ ê°™ì´ ë¹ˆ ë“±ë¡ ë° ì£¼ì…ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì„±ëŠ¥ ì¸¡ì •

### ì‚¬ì „ ì„¤ì •

ë¨¼ì € ê¸°ë³¸ì ì¸ Thread Pool ì„ í†µí•´ ë‹¤ì‹œ ì‹œê°„ì„ ì¸¡ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.

```java
@Bean(name = "apiExecutor")  
public Executor apiExecutor() {  
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();  
    executor.setCorePoolSize(10);  
    executor.setMaxPoolSize(100);  
    executor.setQueueCapacity(25);  
    executor.initialize();  
    return executor;  
}  
  
@Bean(name = "clientExecutor")  
public Executor clientExecutor() {  
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();  
    executor.setCorePoolSize(10);  
    executor.setMaxPoolSize(100);  
    executor.setQueueCapacity(25);  
    executor.initialize();  
    return executor;  
}
```

```java
public GithubReviewProvider(final GithubPullRequestReviewClient reviewClient,  
                            final GithubPullRequestCommentClient commentClient,  
                            final @Qualifier("apiExecutor") Executor executor) {  
    this.reviewClient = reviewClient;  
    this.commentClient = commentClient;  
    this.executor = executor;  
}

public GithubPullRequestCommentClient(RestClient restClient,  
                                      GithubPullRequestUrlExchanger githubPullRequestUrlExchanger,  
                                      GithubPersonalAccessTokenProvider githubPersonalAccessTokenProvider,  
                                      @Qualifier("clientExecutor")Executor executor) {  
    super(restClient, githubPullRequestUrlExchanger, githubPersonalAccessTokenProvider,executor);  
}
```

ì™€ ê°™ì´ `Executor` ë¥¼ ì„¤ì • ë° ì£¼ì…í–ˆìŠµë‹ˆë‹¤.

```
[2024-11-09 23:34:34:14131] [clientExecutor-10] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$1:20] - Running in thread: clientExecutor-10 
[2024-11-09 23:34:34:14131] [apiExecutor-14] INFO  [corea.global.util.FutureUtil.lambda$supplyAsync$1:20] - Running in thread: apiExecutor-14 
```

ë¡œê·¸ë¥¼ ì°ì–´ í™•ì¸í•˜ë©´ ì„±ê³µì ìœ¼ë¡œ ìŠ¤ë ˆë“œë¥¼ ì œê³µí•´ì¤ë‹ˆë‹¤.

### ë‹¤ì¤‘ í…ŒìŠ¤íŠ¸

í…ŒìŠ¤íŠ¸ëŠ” ë‘ê°€ì§€ë¡œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.
- ê°ê° ìš”ì²­ì„ ë™ê¸°ë¡œ ì‹¤í–‰í•´ì„œ ì´ ì‹œê°„ ì¸¡ì •
```java
startTime = System.nanoTime();  
ary.forEach(integer -> githubReviewProvider.getGithubPullRequestReviewInfoSync("https://github.com/woowacourse-precourse/java-racingcar-6/pull/"+integer)); 
endTime = System.nanoTime();  
printElapsedTime("ê¸°ì¡´ ì½”ë“œ : ", endTime - startTime);
```

- ìš”ì²­ë“¤ì„ ë¹„ë™ê¸°ë¡œ í•œë²ˆì— ì‹¤í–‰í•´ì„œ ì´ ì‹œê°„ ì¸¡ì •
```java
private <T> void executeAsync(String text) {  
    long startTime = System.nanoTime();  
    List<CompletableFuture<T>> futures = ary.stream()  
            .map(integer -> (CompletableFuture<T>) FutureUtil.supplyAsync(() -> githubReviewProvider.getGithubPullRequestReviewInfoAsync("https://github.com/woowacourse-precourse/java-racingcar-6/pull/" + integer)))  
            .toList();  
    CompletableFuture<Void> allOf = CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]));  
    allOf.join();
    long endTime = System.nanoTime();  
    printElapsedTime(text, endTime - startTime);  
}
```

```
ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 37 seconds, 226 milliseconds, 116 microseconds, 417 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 29 seconds, 496 milliseconds, 377 microseconds, 584 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 27 seconds, 292 milliseconds, 174 microseconds, 42 nanoseconds

ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 6 seconds, 385 milliseconds, 892 microseconds, 541 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 3 seconds, 164 milliseconds, 544 microseconds, 83 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 3 seconds, 568 milliseconds, 894 microseconds, 125 nanoseconds
```

```
ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 40 seconds, 564 milliseconds, 653 microseconds, 83 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 27 seconds, 4 milliseconds, 581 microseconds, 709 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 28 seconds, 122 milliseconds, 420 microseconds, 667 nanoseconds

ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 5 seconds, 969 milliseconds, 698 microseconds, 83 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 3 seconds, 35 milliseconds, 963 microseconds, 917 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 3 seconds, 319 milliseconds, 663 microseconds, 208 nanoseconds
```

ì´ì™€ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤. 

- ì²« ë²ˆì§¸ ì¼€ì´ìŠ¤ì—ì„œëŠ” 26.68~33.41%ê¹Œì§€ ë‹¨ì¶•
- ë‘ ë²ˆì§¸ ì¼€ì´ìŠ¤ì—ì„œëŠ”  44.13~49.16%ê¹Œì§€ ë‹¨ì¶•

ì˜ ê²°ê³¼ê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤. ~~( ì™œ ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²°í•œê²Œ ë” ì§§ì€ì§€ëŠ” ëª…í™•í•˜ê²Œ ëª¨ë¥´ê² ë„¤ìš”.. ğŸ¥² )~~
( ì‹œê°„ì˜ ì°¨ì´ëŠ” ì•ì„œ ë³´ë‚¸ Preflight ìš”ì²­ ë•Œë¬¸ì¸ê±¸ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì€ ì¶”ê°€ í˜ì´ì§€ë„¤ì´ì…˜ì„ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ”ë°, ì˜¤íˆë ¤ ì‹œê°„ì„ ì¦ê°€ì‹œí‚´ )

```java
@Bean(name = "apiExecutor")  
public Executor apiExecutor() {  
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();  
    executor.setCorePoolSize(20);  
    executor.setMaxPoolSize(50);  
    executor.setMaxPoolSize(100);  
    executor.setQueueCapacity(25);  
    executor.initialize();  
    return executor;  
}  
  
@Bean(name = "clientExecutor")  
public Executor clientExecutor() {  
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();  
    executor.setCorePoolSize(10);  
    executor.setMaxPoolSize(30);  
    executor.setQueueCapacity(50);  
    executor.initialize();  
    return executor;  
}
```

ì´ì™€ê°™ì´ ë³€ê²½ì„ í•˜ë©´?

```
ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 39 seconds, 303 milliseconds, 886 microseconds, 125 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 29 seconds, 721 milliseconds, 726 microseconds, 334 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 28 seconds, 156 milliseconds, 877 microseconds, 208 nanoseconds

ê¸°ì¡´ ì½”ë“œ : Elapsed Time: 5 seconds, 757 milliseconds, 605 microseconds, 500 nanoseconds
ì²« ë²ˆì§¸ ë¬¸ì œë§Œ í•´ê²° : Elapsed Time: 2 seconds, 885 milliseconds, 556 microseconds, 875 nanoseconds
ë‘˜ë‹¤ í•´ê²° : Elapsed Time: 3 seconds, 560 milliseconds, 182 microseconds, 916 nanoseconds
```

í° ì°¨ì´ê°€ ì—†ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ê²°ë¡ 


ê·¸ë¼íŒŒë‚˜ë¥¼ í†µí•´ ë„ì… ì „ / í›„ ì§€í‘œë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

![](https://i.imgur.com/hhgczmf.png)

ì‘ë‹µì‹œê°„ì€ ë¹„ë™ê¸° ë„ì… í›„ 600ms -> 400ms ê°€ëŸ‰ìœ¼ë¡œ **33%** ë¹¨ë¼ì¡ŒìŠµë‹ˆë‹¤.

![](https://i.imgur.com/TNd2Xew.png)

í™ ë©”ëª¨ë¦¬ë„ í° í”¼í¬ëŠ” íŠ€ì§€ ì•ŠëŠ”ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
( ë¬¼ë¡ , CPU ì˜¤ë²„í—¤ë“œ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ì´ëŠ” ë‹¹ì¥ í™•ì¸ ëª»í–ˆìŠµë‹ˆë‹¤. )

ì´ë ‡ê²Œ
- ì–´ë””ê¹Œì§€ ë¹„ë™ê¸°ë¥¼ ë„ì…í•  ì§€
- ë¹„ë™ê¸°ë¥¼ í†µí•´ ìˆ˜í–‰ì‹œ ì–¼ë§ˆë‚˜ ì‹œê°„ íš¨ìœ¨ì´ ë˜ëŠ”ì§€
- ë¹„ë™ê¸°ë¥¼ í†µí•´ ìˆ˜í–‰í•˜ë©´ í™ ë©”ëª¨ë¦¬ ë˜ëŠ” CPU ë¬¸ì œê°€ ì—†ëŠ”ì§€

ë“±ì„
ê°ì íŒ€ì´ í™•ì¸ì„ í•´ë³´ê³  ìƒí™©ì— ë§ê²Œ ë„ì…ì„ í•´ë³´ë©´ ì¢‹ì„ê±° ê°™ìŠµë‹ˆë‹¤! ğŸ™‚

> ì‚¬ìš©ì ê²½í—˜ì´ ë¬´ì¡°ê±´ 1ìˆœìœ„ë¼ê³  ìƒê°ì€ í•˜ë‚˜, ì ì ˆí•˜ê²Œ íƒ€í˜‘ì€ í•´ì•¼í• ê±° ê°™ìŠµë‹ˆë‹¤.
> ( ê³¼ë„í•œ ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´ 
Thread Pool ì— ë§¤ìš° ë§ì€ ìŠ¤ë ˆë“œë‚˜ ë¬´í•œ ëŒ€ê¸°ì—´ ë•Œë¬¸ì— ì„œë²„ê°€ í„°ì§„ë‹¤ë©´ ë” ìµœì•…ì¼í…Œë‹ˆê¹Œìš”  )