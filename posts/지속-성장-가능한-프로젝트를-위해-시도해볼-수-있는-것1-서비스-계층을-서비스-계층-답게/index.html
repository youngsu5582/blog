<!doctype html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게" /><meta name="author" content="이영수" /><meta property="og:locale" content="ko" /><meta name="description" content="서비스 계층이 100줄이 넘어가고, private 메소드가 10개가 넘어가는 당신이라면" /><meta property="og:description" content="서비스 계층이 100줄이 넘어가고, private 메소드가 10개가 넘어가는 당신이라면" /><link rel="canonical" href="https://youngsu5582.life//posts/%EC%A7%80%EC%86%8D-%EC%84%B1%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%8B%9C%EB%8F%84%ED%95%B4%EB%B3%BC-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%831-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5%EC%9D%84-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5-%EB%8B%B5%EA%B2%8C/" /><meta property="og:url" content="https://youngsu5582.life//posts/%EC%A7%80%EC%86%8D-%EC%84%B1%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%8B%9C%EB%8F%84%ED%95%B4%EB%B3%BC-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%831-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5%EC%9D%84-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5-%EB%8B%B5%EA%B2%8C/" /><meta property="og:site_name" content="이영수 개발 블로그" /><meta property="og:image" content="https://velog.velcdn.com/images/dragonsu/post/c287c4ed-5ecf-456d-8826-4483b22268fe/image.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-10-21T00:47:58+09:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://velog.velcdn.com/images/dragonsu/post/c287c4ed-5ecf-456d-8826-4483b22268fe/image.png" /><meta property="twitter:title" content="지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"이영수"},"dateModified":"2024-10-21T00:47:58+09:00","datePublished":"2024-10-21T00:47:58+09:00","description":"서비스 계층이 100줄이 넘어가고, private 메소드가 10개가 넘어가는 당신이라면","headline":"지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게","image":"https://velog.velcdn.com/images/dragonsu/post/c287c4ed-5ecf-456d-8826-4483b22268fe/image.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://youngsu5582.life//posts/%EC%A7%80%EC%86%8D-%EC%84%B1%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%8B%9C%EB%8F%84%ED%95%B4%EB%B3%BC-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%831-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5%EC%9D%84-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5-%EB%8B%B5%EA%B2%8C/"},"url":"https://youngsu5582.life//posts/%EC%A7%80%EC%86%8D-%EC%84%B1%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%8B%9C%EB%8F%84%ED%95%B4%EB%B3%BC-%EC%88%98-%EC%9E%88%EB%8A%94-%EA%B2%831-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5%EC%9D%84-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%B8%B5-%EB%8B%B5%EA%B2%8C/"}</script><title>지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게 | 이영수 개발 블로그</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="이영수 개발 블로그"><meta name="application-name" content="이영수 개발 블로그"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/ko.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GDSPGC31HX"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-GDSPGC31HX'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">이영수 개발 블로그</a><p class="site-subtitle fst-italic mb-0">Learning Kata</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span></span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/articles/" class="nav-link"> <i class="fa-fw "></i> <span>ARTICLES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/youngsu5582" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['joyson5582','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/%EC%98%81%EC%88%98-%EC%9D%B4-b78498347/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://www.rallit.com/hub/resumes/988543/%EC%9D%B4%EC%98%81%EC%88%98" aria-label="resume" target="_blank" rel="noopener noreferrer" > <i class="fas fa-file-alt"></i> </a> <a href="https://comet-pram-809.notion.site/185365707b6580859ec5ec052f2f6730" aria-label="portfolio" target="_blank" rel="noopener noreferrer" > <i class="fas fa-laptop-code"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"></a> </span> <span>지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button><style> .language-switcher { display: flex; gap: 10px; list-style: none; margin: 0; padding: 0; } .language-switcher li a { padding: 5px 10px; border: 1px solid #ccc; border-radius: 5px; text-decoration: none; color: #333; background-color: #f0f0f0; } .language-switcher li a:hover { background-color: #e0e0e0; } .language-switcher li .active-lang { /* 현재 활성화된 언어 텍스트 스타일 */ padding: 5px 10px; border: 1px solid #007bff; border-radius: 5px; color: white; background-color: #007bff; cursor: default; }</style><ul class="language-switcher"><li> <span class="active-lang">한국어</span><li> <a href="https://youngsu5582.life//en/">English</a></ul><search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel"></button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게</h1><p class="post-desc fw-light mb-4">서비스 계층이 100줄이 넘어가고, private 메소드가 10개가 넘어가는 당신이라면</p><div class="post-meta text-muted"> <span> <time data-ts="1729439278" data-df="DD/MM/YYYY" data-bs-toggle="tooltip" data-bs-placement="bottom" > 21/10/2024 </time> </span><div class="mt-3 mb-3"> <a href="https://velog.velcdn.com/images/dragonsu/post/c287c4ed-5ecf-456d-8826-4483b22268fe/image.png" class="popup img-link preview-img shimmer"><img src="https://velog.velcdn.com/images/dragonsu/post/c287c4ed-5ecf-456d-8826-4483b22268fe/image.png" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> <em> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4887 " > <em>27 </em> </span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1"></span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">지속 성장 가능한 프로젝트를 위해 시도해볼 수 있는 것(1) - 서비스 계층을 서비스 계층 답게</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog> <br><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">프로그래밍</a>, <a href="/categories/%ED%81%B4%EB%A6%B0%EC%BD%94%EB%93%9C/">클린코드</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/%EA%B5%AC%ED%98%84-%EA%B3%84%EC%B8%B5/" class="post-tag no-text-decoration" >구현 계층</a> <a href="/tags/%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81/" class="post-tag no-text-decoration" >리팩토링</a> <a href="/tags/%EC%9A%B0%ED%85%8C%EC%BD%94/" class="post-tag no-text-decoration" >우테코</a> <a href="/tags/%ED%81%B4%EB%A6%B0-%EC%BD%94%EB%93%9C/" class="post-tag no-text-decoration" >클린 코드</a></div><div class="content"><p>해당 내용은 (현) 토스 개발자인 제미니 님의</p><p><a href="https://geminikims.medium.com/%EC%A7%80%EC%86%8D-%EC%84%B1%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%96%B4%EA%B0%80%EB%8A%94-%EB%B0%A9%EB%B2%95-97844c5dab63">지속 성장 가능한 소프트웨어를 만들어가는 방법 - 아티클</a> <a href="https://www.youtube.com/watch?v=pimYIfXCUe8">지속 성장 가능한 소프트웨어를 만들어가는 방법 영상 - 아티클</a></p><p>내용을 읽고 프로젝트에서 도입을 하며 느낀점 + 코드를 리팩토링 하며 느낀점들에 대해 다룹니다. ( 틀린 내용, 궁금한 점이 있으면 <code class="language-plaintext highlighter-rouge">joyson5582@gmail.com</code> 이나 댓글로 남겨주세요! )</p><h2 id="왜-코드는-더러워지는가"><span class="me-2">왜 코드는 더러워지는가</span><a href="#왜-코드는-더러워지는가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>사실, 코드가 더러워지는건 너무도 당연한 수순입니다. 우리의 프로젝트가 사용자의 요구 ( 또는 받아들일 설계 ) 를 반영하기 위해 기능을 좀 더 세밀하게 &amp; 추가해야 하기 때문입니다.</p><p><a href="https://i.imgur.com/lbZTEqn.png" class="popup img-link shimmer"><img src="https://i.imgur.com/lbZTEqn.png" alt="600" loading="lazy"></a></p><p>저희 프로젝트에서 가장 중요한 ( 코드 리뷰를 매칭 시켜주는 ) 방 의 관련된 로직을 수행하는 <code class="language-plaintext highlighter-rouge">RoomService</code> 만 해도 13일 부터 19일 까지 8번의 수정 사항이 발생했습니다.</p><p><a href="https://i.imgur.com/HzDEz9Y.png" class="popup img-link shimmer"><img src="https://i.imgur.com/HzDEz9Y.png" alt="600" loading="lazy"></a></p><p>기능이 추가함에 따라 크기가 크든, 작든 꾸준히 코드를 쌓게 됩니다.</p><p>그리고, 이런 코드들은 단위로 얼마나 깔끔하게 짜든 서비스의 공간을 차지하게 됩니다. ( 위의 <code class="language-plaintext highlighter-rouge">stream</code> 구문은 문제를 느낄 요소가 없는 것 처럼요 )</p><h2 id="기존-mvc-는-뭐가-문제일까"><span class="me-2">기존 MVC 는 뭐가 문제일까?</span><a href="#기존-mvc-는-뭐가-문제일까" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>흔히, 웹 개발자가 아는 가장 유명한 디자인 패턴은 MVC 패턴일 겁니다.</p><ul><li>Controller : 사용자 요청을 처리하고, <code class="language-plaintext highlighter-rouge">Model</code> - <code class="language-plaintext highlighter-rouge">View</code> 를 연결해준다.<li>View : 사용자의 UI 를 담당한다.<li>Model : 애플리케이션 핵심 데이터 &amp; 비즈니스 로직을 담당한다.</ul><p>자바 계열의 스프링, 자바스크립트 계열의 네스트(Nest.js), 파이선 계열의 장고(Django) 등 대부분의 웹 서버 프레임워크가 이를 도입하고 있습니다.</p><p>이런 MVC 패턴에서 서비스 레이어는 사실상 필연적입니다. Controller Model 간 중간 계층을 하나 더 만들어서 비즈니스 로직을 수행함으로써 비즈니스 로직을 재사용하게 해줍니다.</p><p>추가적으로, <code class="language-plaintext highlighter-rouge">TO(Transfer Object)</code> 를 통해서</p><ul><li>웹 요청을 일관성 &amp; 용이하게<li>도메인 에서 사용자가 원하는 응답을 재사용 가능하게 일반적으로 웹 프레임워크를 구축합니다.</ul><p>그러면, 왜 디자인 패턴과 정형화된 레이어가 있는데 코드는 계속 더러워져만 갈까요?</p><h3 id="서비스-계층은-해야하는게-너무나-많다"><span class="me-2">서비스 계층은 해야하는게 너무나 많다.</span><a href="#서비스-계층은-해야하는게-너무나-많다" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>이 서비스는 너무나도 많은 역할을 가지는 경우가 많습니다. ( 사실, 서비스 계층이 완벽하게 정립 및 재사용이 가능하다면, 최고일 겁니다. )</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="nc">RoomResponse</span> <span class="nf">update</span><span class="o">(</span><span class="kt">long</span> <span class="n">memberId</span><span class="o">,</span> <span class="nc">RoomUpdateRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">getRoom</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">roomId</span><span class="o">());</span>
	
	<span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">memberId</span><span class="o">)</span>
			<span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">MEMBER_NOT_FOUND</span><span class="o">));</span>
	
	<span class="k">if</span> <span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">isNotMatchingManager</span><span class="o">(</span><span class="n">memberId</span><span class="o">))</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">MEMBER_IS_NOT_MANAGER</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="k">if</span> <span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">isNotOpened</span><span class="o">())</span> <span class="o">{</span>  
	    <span class="k">throw</span> <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">ROOM_STATUS_INVALID</span><span class="o">);</span>  
	<span class="o">}</span>

	<span class="nc">Room</span> <span class="n">updatedRoom</span> <span class="o">=</span> <span class="n">roomRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">room</span><span class="o">,</span><span class="n">member</span><span class="o">));</span>
	<span class="nc">Participation</span> <span class="n">participation</span> <span class="o">=</span> <span class="n">participationRepository</span><span class="o">.</span><span class="na">findByRoomIdAndMemberId</span><span class="o">(</span><span class="n">updatedRoom</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">memberId</span><span class="o">)</span>
			<span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">NOT_ALREADY_APPLY</span><span class="o">));</span>


	<span class="n">automaticMatchingRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">AutomaticMatching</span><span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">request</span><span class="o">.</span><span class="na">recruitmentDeadline</span><span class="o">()));</span>
	<span class="n">automaticMatchingService</span><span class="o">.</span><span class="na">matchOnRecruitmentDeadline</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
	
	<span class="n">automaticUpdateRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">AutomaticUpdate</span><span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">request</span><span class="o">.</span><span class="na">reviewDeadline</span><span class="o">()));</span>
	<span class="n">automaticUpdateService</span><span class="o">.</span><span class="na">updateAtReviewDeadline</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
	
	
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"방을 수정했습니다. 방 id={}, 사용자 iD={}"</span><span class="o">,</span> <span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
	
	<span class="k">return</span> <span class="nc">RoomResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">updatedRoom</span><span class="o">,</span> <span class="n">participation</span><span class="o">.</span><span class="na">getMemberRole</span><span class="o">(),</span> <span class="nc">ParticipationStatus</span><span class="o">.</span><span class="na">MANAGER</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>방을 수정하는 로직으로 예시를 살펴보겠습니다.</p><ol><li>roomId 와 memberId 를 통해 조회를 합니다.<li>방이 열려있는지 확인합니다.<li>방의 매니저가 맞는지 확인합니다.<li>DTO 를 통해 방을 수정합니다.<li>Manager 가 참여한 역할을 찾습니다.<li>스케줄러에 등록된 매칭 &amp; 종료 시간을 수정합니다.<li>방을 수정했다는 로그를 작성합니다.<li>위의 값들을 통해 응답으로 변환합니다.</ol><p>하나씩 나열해보면, 꽤나 타당하고 명확합니다. 이와 같이 서비스 계층은 계속 뚱뚱해져 가게 됩니다.</p><h3 id="모호한-이름의-서비스"><span class="me-2">모호한 이름의 서비스</span><a href="#모호한-이름의-서비스" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>일반적으로 도메인과 서비스 이름을 1:1로 매칭을 시키는 경우가 있습니다. ( 또는, 컨트롤러와 1:1 매칭 <code class="language-plaintext highlighter-rouge">RoomController - RoomService</code> )</p><p>처음 도메인을 새로 만들 때는 나쁘지 않습니다. 방의 비즈니스 로직을 담당하는 서비스이자, 기능도 몇개가 되지 않아서 타당하게 보일 테니까요.</p><p>하지만, 기능이 늘어남에 따라 서비스 코드는 뚱뚱해지게 됩니다.</p><blockquote><p>RoomService 니까..?</p><ul><li>방을 생성 / 수정 / 삭제하는 기능이 있어야지 🙂<li>방의 상태 ( 오픈 / 진행 중 / 종료 ) 에 따른 조회하는 기능도 추가 해야지 🥲🥲<li>방에 참가한 참가자들을 보여주고 싶은데 RoomService 의 기능인가…?<li>사용자가 참가한 방을 보고 싶은데 또 RoomService 야? 😢😢</ul></blockquote><p>이렇게 하게 된 이유는 <code class="language-plaintext highlighter-rouge">@RequestMapping("/rooms")</code> 와 같이 경로 매핑을 <code class="language-plaintext highlighter-rouge">rooms</code> 로 했기에 , 동일한 경로는 다 같은 곳에 묶고 싶다는 욕심 때문도 있을 겁니다.</p><p><a href="https://i.imgur.com/zuea6pI.png" class="popup img-link shimmer"><img src="https://i.imgur.com/zuea6pI.png" alt="" loading="lazy"></a></p><p>다양한 도메인에서 import, 긴 코드 라인(<code class="language-plaintext highlighter-rouge">175 lines</code>) 이 되게 됩니다. 이런 파일은 코드를 사용해야 하는 사람도 어려움을 겪을 겁니다. 😢</p><p>그러면, 이를 천천히 리팩토링 해나가보겠습니다.</p><h2 id="readerwrtier-를-통한-비즈니스-로직-명세화"><span class="me-2">Reader,Wrtier 를 통한 비즈니스 로직 명세화</span><a href="#readerwrtier-를-통한-비즈니스-로직-명세화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>방을 수정하는 로직을 다시 살펴보겠습니다.</p><ol><li>roomId 와 memberId 를 통해 조회를 합니다.<li>방이 열려있는지 확인합니다.<li>방의 매니저가 맞는지 확인합니다.<li>DTO 를 통해 방을 수정합니다.<li>방을 수정했다는 로그를 작성합니다.<li>Manager 가 참여한 역할을 찾습니다.<li>스케줄러에 등록된 매칭 &amp; 종료 시간을 수정합니다.<li>위의 값들을 통해 응답으로 변환합니다.</ol><p>하지만, 우리가 기대하는 방의 수정 로직이라면</p><ul><li>방과 매니저가 있는걸 조회한다.<li>방과 매니저를 통해 요청대로 수정한다<li>수정한 방 정보에 맞게 스케줄러를 수정한다</ul><p>정도 입니다. 그러면, 위의 기대를 충족하기 위해 Reader 와 Writer 를 만들어보겠습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>  
<span class="nd">@RequiredArgsConstructor</span>  
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RoomReader</span> <span class="o">{</span>  
  
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">RoomRepository</span> <span class="n">roomRepository</span><span class="o">;</span>  
  
    <span class="kd">public</span> <span class="nc">Room</span> <span class="nf">find</span><span class="o">(</span><span class="kt">long</span> <span class="n">roomId</span><span class="o">)</span> <span class="o">{</span>  
        <span class="k">return</span> <span class="n">roomRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">roomId</span><span class="o">)</span>  
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span>  
                        <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span>
	                        <span class="nc">ExceptionType</span><span class="o">.</span><span class="na">ROOM_NOT_FOUND</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"해당 Id의 방이 없습니다. 입력된 Id=%d"</span><span class="o">,</span> <span class="n">roomId</span><span class="o">)));</span>  
    <span class="o">}</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>와 같이 Room 을 조회하는거 담당하는 <code class="language-plaintext highlighter-rouge">Reader</code> 입니다.</p><blockquote><p>이 Reade Wrtier 를 좀 더 명확히 하고 싶다면?</p></blockquote><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Component</span>  
<span class="nd">@RequiredArgsConstructor</span>  
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Reader</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><p>( 위와 같이 어노테이션도 만들어서 명확하게 명시 가능합니다. )</p><hr /><p>그냥 <code class="language-plaintext highlighter-rouge">RoomRepository</code> 를 사용해서 조회를 하는게 아닌, 방과 관련된 요소들을 조회 하는 책임을 가지는 클래스 입니다. 이를 통해서, 각 서비스 계층이 조회를 할 때마다 <code class="language-plaintext highlighter-rouge">getXXX</code> 을 가지는 것을 방지하게 해줍니다. ( 추가로, 예외도 일관성 있게 작성을 시켜줍니다. )</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Room</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">RoomUpdateRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>  
    <span class="n">validate</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>  
    <span class="k">return</span> <span class="n">roomRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">));</span>  
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">isNotMatchingManager</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">()))</span> <span class="o">{</span>  
        <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"인증되지 않은 방 변경 시도 방 생성자 id={}, 요청한 사용자 id={}"</span><span class="o">,</span> <span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>  
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">ROOM_MODIFY_AUTHORIZATION_ERROR</span><span class="o">);</span>  
    <span class="o">}</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">isNotOpened</span><span class="o">())</span> <span class="o">{</span>  
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">ROOM_STATUS_INVALID</span><span class="o">);</span>  
    <span class="o">}</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>방을 수정하기 전 수정하려는 사람이 방을 만든 사람이 맞는지, 방이 열려있는지를 확인합니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Room</span> <span class="nf">toEntity</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Room</span><span class="o">(</span>  
            <span class="n">roomId</span><span class="o">,</span>  
            <span class="n">title</span><span class="o">,</span> <span class="n">content</span><span class="o">,</span>  
            <span class="n">matchingSize</span><span class="o">,</span> <span class="n">repositoryLink</span><span class="o">,</span>  
            <span class="n">thumbnailLink</span><span class="o">,</span> <span class="n">keywords</span><span class="o">,</span> <span class="n">currentParticipatsSize</span><span class="o">,</span> <span class="n">limitedParticipants</span><span class="o">,</span>  
            <span class="n">member</span><span class="o">,</span> <span class="n">recruitmentDeadline</span><span class="o">,</span>  
            <span class="n">reviewDeadline</span><span class="o">,</span> <span class="n">classification</span><span class="o">,</span>  
            <span class="n">room</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span>  
    <span class="o">);</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>그 후, DTO 를 통해 엔티티를 만들어서 저장합니다. ( 저희 팀은 DTO -&gt; 엔티티,도메인으로 변환하는걸 적극적으로 사용하기로 했습니다. 단순 웹 요청 / 응답에서 변환을 위해 RequestMapper 와 같은걸 만드는건 불필요하다고 판단했기 때문입니다. )</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>  
<span class="kd">public</span> <span class="nc">RoomResponse</span> <span class="nf">update</span><span class="o">(</span><span class="kt">long</span> <span class="n">memberId</span><span class="o">,</span> <span class="nc">RoomUpdateRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>  
    <span class="nc">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">roomReader</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">roomId</span><span class="o">());</span>  
    <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberReader</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>  
  
    <span class="nc">Room</span> <span class="n">updatedRoom</span> <span class="o">=</span> <span class="n">roomWriter</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
    <span class="o">...</span>
</pre></table></code></div></div><p>이와 같은 식으로 변환이 가능해집니다. 그러면, 왜 이렇게 해야 하는가? 에 대해서 의견을 남기겠습니다. ( <a href="https://github.com/woowacourse-teams/2024-corea/pull/610#discussion_r1801315976">프로젝트 내 Reader/Writer 도입에 대한 토론</a> )</p><p>더 다듬어서 여기에 정리를 해보면</p><h3 id="정책-및-코드--엔티티-변경이-서비스에-영향을-주지-않는다"><span class="me-2">정책 및 코드 &amp; 엔티티 변경이 서비스에 영향을 주지 않는다</span><a href="#정책-및-코드--엔티티-변경이-서비스에-영향을-주지-않는다" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>정책부터 설명을 해보겠습니다.</p><p>현재, 방을 만들 떄 방장이 방에 참여하는 로직을 포함합니다. ( 방을 만들고, 방장이 리뷰어로 참여해야 한다는 정책 때문에 )</p><p>나중에, <code class="language-plaintext highlighter-rouge">방장이 굳이 리뷰어로 참여할 필요가 없을거 같은데?</code>와 같이 변경이 된다면?</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// RoomWriter</span>
<span class="kd">public</span> <span class="nc">Room</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">RoomCreateRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>  
	<span class="nc">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">roomRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">member</span><span class="o">));</span>  
	<span class="n">participationWriter</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="nc">MemberRole</span><span class="o">.</span><span class="na">REVIEWER</span><span class="o">,</span> <span class="nc">ParticipationStatus</span><span class="o">.</span><span class="na">MANAGER</span><span class="o">);</span>  
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"방을 생성했습니다. 방 생성자 id={}, 요청한 사용자 id={}"</span><span class="o">,</span> <span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">room</span><span class="o">.</span><span class="na">getManagerId</span><span class="o">());</span>  
	<span class="k">return</span> <span class="n">room</span><span class="o">;</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>해당 로직에서, <code class="language-plaintext highlighter-rouge">participationWriter</code> 부분만 제거를 하면 됩니다. 즉, 서비스는 코드를 수정하지 않아도 됩니다.</p><p>두 번째로, 코드 &amp; 엔티티 변경 부분 입니다. 방이 현재 참여하는 인원을 가지고 있는 있습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Room</span> <span class="kd">extends</span> <span class="nc">BaseTimeEntity</span> <span class="o">{</span>

	<span class="o">...</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">currentParticipantsSize</span><span class="o">;</span>
	
	<span class="o">...</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">participate</span><span class="o">()</span> <span class="o">{</span>  
	    <span class="n">validateOpened</span><span class="o">();</span>  
	    <span class="k">if</span> <span class="o">(</span><span class="n">currentParticipantsSize</span> <span class="o">&gt;=</span> <span class="n">limitedParticipantsSize</span><span class="o">)</span> <span class="o">{</span>  
	        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">ROOM_PARTICIPANT_EXCEED</span><span class="o">);</span>  
	    <span class="o">}</span>  
	    <span class="n">currentParticipantsSize</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>  
	<span class="o">}</span>  
	  
	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">validateOpened</span><span class="o">()</span> <span class="o">{</span>  
	    <span class="k">if</span> <span class="o">(</span><span class="n">status</span><span class="o">.</span><span class="na">isNotOpened</span><span class="o">())</span> <span class="o">{</span>  
	        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CoreaException</span><span class="o">(</span><span class="nc">ExceptionType</span><span class="o">.</span><span class="na">ROOM_STATUS_INVALID</span><span class="o">);</span>  
	    <span class="o">}</span>  
	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>나중에, 이를 제거하고 <code class="language-plaintext highlighter-rouge">count(*)</code> 와 같이 알아오게 된다면?</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">RoomInfo</span> <span class="nf">readRoomInfo</span><span class="o">(</span><span class="kt">long</span> <span class="n">roomId</span><span class="o">)</span> <span class="o">{</span>  
    <span class="nc">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">find</span><span class="o">(</span><span class="n">roomId</span><span class="o">);</span>  
    <span class="kt">long</span> <span class="n">participationCount</span> <span class="o">=</span> <span class="n">participationReader</span><span class="o">.</span><span class="na">countParticipantsByRoomId</span><span class="o">(</span><span class="n">roomId</span><span class="o">);</span>  
    <span class="k">return</span> <span class="k">new</span> <span class="nf">RoomInfo</span><span class="o">(...);</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>와 같이 reader 를 통해 참가자의 수를 가져오게 됩니다. 서비스는 여전히 변경을 알지 못합니다.</p><p>이에 대해서는 <a href="https://product.kyobobook.co.kr/detail/S000001033128">실용주의 프로그래머</a> 에서 아래 내용에도 같이 나와 있습니다.</p><p><a href="https://i.imgur.com/ZpOXJES.png" class="popup img-link shimmer"><img src="https://i.imgur.com/ZpOXJES.png" alt="600" loading="lazy"></a></p><p>( 좋은 인사이트를 준 아루에게 감사를 🙏🙏 )</p><h3 id="재-사용-될-수-있게"><span class="me-2">재 사용 될 수 있게</span><a href="#재-사용-될-수-있게" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>가장 쉬우면서 어려운 설명입니다. 예시와 함께 좀 더 설명해보겠습니다.</p><p>방을 참여할 때</p><ul><li>자신이 어떤 역할로 참여하길 원하는지 ( 리뷰어/리뷰이 둘다, 리뷰어, 리뷰이 )<li>자신이 몇명을 해주길 원하는지<li>방장인지 / 그냥 참여하는지 를 결정해서 참여합니다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//RoomService</span>
<span class="kd">public</span> <span class="nc">RoomResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kt">long</span> <span class="n">memberId</span><span class="o">,</span> <span class="nc">RoomCreateRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="nc">Participation</span> <span class="n">participation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Participation</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">manager</span><span class="o">);</span>
	<span class="n">participationRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">participation</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// Participation</span>
<span class="kd">public</span> <span class="nf">Participation</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="nc">MemberRole</span><span class="o">.</span><span class="na">REVIEWER</span><span class="o">,</span> <span class="nc">ParticipationStatus</span><span class="o">.</span><span class="na">MANAGER</span><span class="o">,</span> <span class="n">room</span><span class="o">.</span><span class="na">getMatchingSize</span><span class="o">());</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>방장이 방을 생성하면서 참가하는 부분입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// ParticipationService</span>
<span class="kd">private</span> <span class="nc">Participation</span> <span class="nf">saveParticipation</span><span class="o">(</span><span class="nc">ParticipationRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
	    <span class="o">...</span>

        <span class="nc">Participation</span> <span class="n">participation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Participation</span><span class="o">(</span><span class="n">getRoom</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">roomId</span><span class="o">()),</span> <span class="n">member</span><span class="o">,</span> <span class="n">memberRole</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">matchingSize</span><span class="o">());</span>
        <span class="n">participation</span><span class="o">.</span><span class="na">participate</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">participationRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">participation</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Participation</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">participate</span><span class="o">()</span> <span class="o">{</span>  
    <span class="n">room</span><span class="o">.</span><span class="na">participate</span><span class="o">();</span>  
<span class="o">}</span>

<span class="kd">public</span> <span class="nf">Participation</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">MemberRole</span> <span class="n">role</span><span class="o">,</span> <span class="kt">int</span> <span class="n">matchingSize</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="n">role</span><span class="o">,</span> <span class="nc">ParticipationStatus</span><span class="o">.</span><span class="na">PARTICIPATED</span><span class="o">,</span> <span class="n">matchingSize</span><span class="o">);</span>
        <span class="n">debug</span><span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>참가자가 참여하는 부분입니다. ( 의도적으로, <code class="language-plaintext highlighter-rouge">Reader/Writer</code> 를 쓰지 않은 예전 코드입니다. )</p><blockquote><p>추가로, 생성자 오버로딩은 정말 정말 추천하지 않습니다.. 테스트 편의성을 위해서나, 코드 간결성을 위해서 할 수 있으나 이는 결국 기능이나 엔티티 변경이 일어날 때 다시 돌아오게 되어 있습니다. ( 처음에는 편해지나, 분기 처리 및 모든 걸 다룰 수 없다는 의미</p><ul><li>현재 저희는 픽스처에서만 사용하는 생성자가 있는데 30 정도 부분에서 사용되서 제거도 못합니다..😢 )</ul></blockquote><p>당장에는 코드적으로 문제도 되지 않고, 길이도 길지 않아서 인지를 못할 수 있습니다.</p><p>하지만, 참가를 하는 로직이 두 곳에서 따로 관리가 된다는 문제가 발생합니다.</p><ul><li>로직이 더 추가될 때마다 두 곳에서 모두 반영이 되야 한다.<li>테스트 코드에서 일관성이 깨질 수 있다. ( 어떤 곳은 이를 사용해 처리, 다른 곳은 다르게 사용해 처리 )</ul><p>이 역시도 <code class="language-plaintext highlighter-rouge">Writer</code> 를 사용해서 처리해보겠습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Participation</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">MemberRole</span> <span class="n">memberRole</span><span class="o">,</span> <span class="nc">ParticipationStatus</span> <span class="n">participationStatus</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">return</span> <span class="nf">create</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="n">memberRole</span><span class="o">,</span> <span class="n">participationStatus</span><span class="o">,</span> <span class="n">room</span><span class="o">.</span><span class="na">getMatchingSize</span><span class="o">());</span>  
<span class="o">}</span>  
  
<span class="kd">public</span> <span class="nc">Participation</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">MemberRole</span> <span class="n">memberRole</span><span class="o">,</span> <span class="kt">int</span> <span class="n">matchingSize</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">return</span> <span class="nf">create</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="n">memberRole</span><span class="o">,</span> <span class="nc">ParticipationStatus</span><span class="o">.</span><span class="na">PARTICIPATED</span><span class="o">,</span> <span class="n">matchingSize</span><span class="o">);</span>  
<span class="o">}</span>  
  
<span class="kd">private</span> <span class="nc">Participation</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">MemberRole</span> <span class="n">memberRole</span><span class="o">,</span> <span class="nc">ParticipationStatus</span> <span class="n">participationStatus</span><span class="o">,</span> <span class="kt">int</span> <span class="n">matchingSize</span><span class="o">)</span> <span class="o">{</span>  
    <span class="nc">Participation</span> <span class="n">participation</span> <span class="o">=</span> <span class="n">participationRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Participation</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="n">memberRole</span><span class="o">,</span> <span class="n">participationStatus</span><span class="o">,</span> <span class="n">matchingSize</span><span class="o">));</span>  
    <span class="n">room</span><span class="o">.</span><span class="na">participate</span><span class="o">();</span>  
    <span class="n">logCreateParticipation</span><span class="o">(</span><span class="n">participation</span><span class="o">);</span>  
    <span class="k">return</span> <span class="n">participation</span><span class="o">;</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>이와 같이 로직을 묶어서 사용을 가능할 거 같습니다. <code class="language-plaintext highlighter-rouge">그냥 안으로 넣은게 다 아니야?</code> 라고 생각할 수 있어서 좀 더 저의 생각을 쓰겠습니다.</p><p>방에 참가하는 로직에 들어가는 값은</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>- 자신이 어떤 역할로 참여하길 원하는지 ( 리뷰어/리뷰이 둘다, 리뷰어, 리뷰이 )
- 자신이 몇명을 해주길 원하는지
- 방장인지 / 그냥 참여하는지
</pre></table></code></div></div><p>라고 했습니다. <code class="language-plaintext highlighter-rouge">Room,Member</code> 는 필연적입니다. ( 멤버가 방을 참여하는데 두개가 없으면…? )</p><p><code class="language-plaintext highlighter-rouge">어떤 역할</code>과 <code class="language-plaintext highlighter-rouge">방장 / 그냥 참여하는지</code>는 미묘하게 묶여 있습니다. 이때, 방의 기본으로 참여할 때는 역할과 권한을 둘 다 받기로 했습니다.</p><p>당장은 방장이 리뷰어 이지만, 어떻게 될지 모를 뿐더러 매칭 크기 역시, 그냥 설정을 하지 않고 방에 참여할 수도 있는 확장성도 존재합니다.</p><p>두 번째는 포괄적인 경우의 기능입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">// RoomService</span>
<span class="n">participationWriter</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">manager</span><span class="o">,</span> <span class="nc">MemberRole</span><span class="o">.</span><span class="na">REVIEWER</span><span class="o">,</span> <span class="nc">ParticipationStatus</span><span class="o">.</span><span class="na">MANAGER</span><span class="o">);</span>

<span class="c1">// ParticipationService</span>
<span class="n">participationWriter</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">room</span><span class="o">,</span> <span class="n">member</span><span class="o">,</span> <span class="n">memberRole</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">matchingSize</span><span class="o">());</span>
</pre></table></code></div></div><p>이와 같이 서비스에서 사용이 가능해집니다.</p><blockquote><p>왜 DTO 로 안 묶었어?</p><p>현재 다른 곳에서는 Service 만을 위한 DTO 를 부분 부분 도입하고 있습니다. ( Input, Output 네이밍과 함께 )</p><p>Service 단에서 살아있는 DTO 이므로 도메인도 가져도 되므로, 더 효율적이라 판단은 하고 있습니다.</p><p>하지만, 당장 매개변수가 늘어날 경우는 없다고 판단 + 명확하게 여러 곳에서 사용될 기능이 아니라고 판단해 만들지 않았습니다.</p></blockquote><h2 id="서비스-계층이-서비스를-호출하는게-괜찮은가"><span class="me-2">서비스 계층이 서비스를 호출하는게 괜찮은가</span><a href="#서비스-계층이-서비스를-호출하는게-괜찮은가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>( 이 내용은 <code class="language-plaintext highlighter-rouge">### 모호한 이름의 서비스</code> 의 내용과도 유사한 의미를 내포합니다. )</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>7. 스케줄러에 등록된 매칭 &amp; 종료 시간을 수정합니다.
</pre></table></code></div></div><p>이제, 이 7번 을 리팩토링 해보겠습니다.</p><p>방을 수정/삭제 할 때 이 스케줄러의 변경 역시도 필연적입니다. DB 에 저장이 되었는데 스케줄러에서는 저장이 제대로 안되면 문제가 발생합니다.</p><p>그렇기에, 트랜잭션도 같은 단위로 묶여야 합니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">...</span>
<span class="n">automaticMatchingRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">AutomaticMatching</span><span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">request</span><span class="o">.</span><span class="na">recruitmentDeadline</span><span class="o">()));</span>
<span class="n">automaticMatchingService</span><span class="o">.</span><span class="na">matchOnRecruitmentDeadline</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>

<span class="n">automaticUpdateRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">AutomaticUpdate</span><span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">request</span><span class="o">.</span><span class="na">reviewDeadline</span><span class="o">()));</span>
<span class="n">automaticUpdateService</span><span class="o">.</span><span class="na">updateAtReviewDeadline</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
<span class="o">...</span>
</pre></table></code></div></div><p>이와 같이 코드를 포함 시킬 수 밖에 없을까요…? 이를 해결 하기 위해</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">roomAutomaticService</span><span class="o">.</span><span class="na">updateMatchingTime</span><span class="o">(</span><span class="n">updatedRoom</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">updatedRoom</span><span class="o">.</span><span class="na">getRecruitmentDeadline</span><span class="o">());</span>
<span class="n">roomAutomaticService</span><span class="o">.</span><span class="na">updateReviewDeadlineTime</span><span class="o">(</span><span class="n">updatedRoom</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">updatedRoom</span><span class="o">.</span><span class="na">getReviewDeadline</span><span class="o">());</span>
</pre></table></code></div></div><p>와 같이 다른 서비스로 분리해서 호출을 할 수 있습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">//RoomAutomaticService</span>
<span class="nd">@Transactional</span>  
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateMatchingTime</span><span class="o">(</span><span class="kt">long</span> <span class="n">roomId</span><span class="o">,</span> <span class="nc">LocalDateTime</span> <span class="n">recruitmentDeadline</span><span class="o">)</span> <span class="o">{</span>  
    <span class="nc">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">roomReader</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">roomId</span><span class="o">);</span>  
    <span class="nc">AutomaticMatching</span> <span class="n">automaticMatching</span> <span class="o">=</span> <span class="n">automaticMatchingReader</span><span class="o">.</span><span class="na">findWithRoom</span><span class="o">(</span><span class="n">room</span><span class="o">);</span>  
  
    <span class="n">automaticMatchingWriter</span><span class="o">.</span><span class="na">updateTime</span><span class="o">(</span><span class="n">automaticMatching</span><span class="o">,</span> <span class="n">recruitmentDeadline</span><span class="o">);</span>  
    <span class="n">automaticMatchingScheduler</span><span class="o">.</span><span class="na">modifyTask</span><span class="o">(</span><span class="n">room</span><span class="o">);</span>  
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>기존 Room 을 넘기지 않고, id 를 넘기고 재 조회를 하는 이유는 다른 컨트롤러 또는 로직에서도 재사용이 가능하게 하기 위함입니다.</p></blockquote><p>이제 해결이 된 걸까요? 제 관점은 조금 다릅니다. 🙂</p><p>서비스가 다른 서비스 계층을 사용하는건 뜨거운 논쟁이 될 수 있습니다. ( 이에 대해서는 <a href="https://github.com/woowacourse/retrospective/discussions/15"># BE | Service에서 Service를 의존할까 Repository(Dao)를 의존할까</a> 예전 선배 기수도 다룬 적이 있는 내용입니다. )</p><p>제 의견으로는 정말 온전한 서비스 계층이 된다면 다른 서비스 계층을 호출할 일이 없다고 생각이 듭니다. ( 물론, 파사드 패턴이라면 모르겠지만 )</p><p>위의 코드도</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// AutomaticMatchingWriter</span>
<span class="kd">public</span> <span class="nc">AutomaticMatching</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Room</span> <span class="n">room</span><span class="o">)</span> <span class="o">{</span>  
    <span class="nc">AutomaticMatching</span> <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AutomaticMatching</span><span class="o">(</span><span class="n">room</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">room</span><span class="o">.</span><span class="na">getRecruitmentDeadline</span><span class="o">());</span>  
    <span class="n">automaticMatchingScheduler</span><span class="o">.</span><span class="na">matchOnRecruitmentDeadline</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>  
    <span class="k">return</span> <span class="n">automaticMatchingRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>  
<span class="o">}</span>
</pre></table></code></div></div><p>위와 같이 Writer 가 Scheduler 까지 같이 가지면 더 의도적이게 됩니다. ( 똑같은 생명주기라고 생각하기에 )</p><p>단순히, 도메인을 CRUD 하는게 아니라 비즈니스 로직 수행을 위해 <code class="language-plaintext highlighter-rouge">구현 계층</code>을 쌓아간다고 생각하면 훨씬 쉽게 만들어 갈 수 있을겁니다.</p><h2 id="결론"><span class="me-2">결론</span><a href="#결론" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>리팩토링은 당장 효과를 보기 어려울 수 있습니다. ( 오히려, 성능을 떨어뜨리거나 에러를 유발할 가능성이 더 높구요 🥲 )</p><p>리팩토링을 해도, 코드가 더러워지는게 두려워 Reader 와 Writer 의 API 를 하나 뚫을 때는 계속 생각을 할 수 있습니다. ( <code class="language-plaintext highlighter-rouge">이게 해당 Reader 에 있어야 하는 코드인가?</code> <code class="language-plaintext highlighter-rouge">재 사용 하려면 어떻게 해야 할까?</code> )</p><p>이런 요소들이 하나 하나가 쌓여서 코드를 더욱 쉽고 수정하기 용이하게 해줍니다.</p><p><a href="https://i.imgur.com/09II7Ro.png" class="popup img-link shimmer"><img src="https://i.imgur.com/09II7Ro.png" alt="" loading="lazy"></a></p><p>175 줄 이였던 코드는 79줄 까지 줄어들었습니다! ( 라인이 줄어드는게 꼭 좋은 점은 아닐 수 있습니다. 물론 )</p><p>기능이 늘어남에 따라 코드가 더욱 비대해지고, 더러워 질 수 있습니다. 그때마다 코드에 관심을 가지고, 의식적으로 변경을 해야 할 겁니다. ( 다음에 기능 확장하거나, 에러를 마주 쳤을 때 한숨을 쉬지 않으려면 )</p><p>위 내용들은 https://github.com/woowacourse-teams/2024-corea 에서 적용하는 내용들입니다.</p><p>다음은 한참 나중에 다루겠지만 <code class="language-plaintext highlighter-rouge">검증을 외부로 분리하기</code> , <code class="language-plaintext highlighter-rouge">외부 API &amp; 테스트 관리하기</code> 그리고 <code class="language-plaintext highlighter-rouge">비동기 역할에 맞게 테스트하기</code> 정도에 대해 다뤄볼거 같네요 🙂</p><p>감사합니다!</p></div><div class="post-tail-wrapper text-muted"><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"></div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted"></span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EC%A7%80%EC%86%8D%20%EC%84%B1%EC%9E%A5%20%EA%B0%80%EB%8A%A5%ED%95%9C%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC%20%EC%9C%84%ED%95%B4%20%EC%8B%9C%EB%8F%84%ED%95%B4%EB%B3%BC%20%EC%88%98%20%EC%9E%88%EB%8A%94%20%EA%B2%83(1)%20-%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EA%B3%84%EC%B8%B5%EC%9D%84%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EA%B3%84%EC%B8%B5%20%EB%8B%B5%EA%B2%8C%20-%20%EC%9D%B4%EC%98%81%EC%88%98%20%EA%B0%9C%EB%B0%9C%20%EB%B8%94%EB%A1%9C%EA%B7%B8&url=https%3A%2F%2Fyoungsu5582.life%2F%2Fposts%2F%25EC%25A7%2580%25EC%2586%258D-%25EC%2584%25B1%25EC%259E%25A5-%25EA%25B0%2580%25EB%258A%25A5%25ED%2595%259C-%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8%25EB%25A5%25BC-%25EC%259C%2584%25ED%2595%25B4-%25EC%258B%259C%25EB%258F%2584%25ED%2595%25B4%25EB%25B3%25BC-%25EC%2588%2598-%25EC%259E%2588%25EB%258A%2594-%25EA%25B2%25831-%25EC%2584%259C%25EB%25B9%2584%25EC%258A%25A4-%25EA%25B3%2584%25EC%25B8%25B5%25EC%259D%2584-%25EC%2584%259C%25EB%25B9%2584%25EC%258A%25A4-%25EA%25B3%2584%25EC%25B8%25B5-%25EB%258B%25B5%25EA%25B2%258C%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyoungsu5582.life%2F%2Fposts%2F%25EC%25A7%2580%25EC%2586%258D-%25EC%2584%25B1%25EC%259E%25A5-%25EA%25B0%2580%25EB%258A%25A5%25ED%2595%259C-%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8%25EB%25A5%25BC-%25EC%259C%2584%25ED%2595%25B4-%25EC%258B%259C%25EB%258F%2584%25ED%2595%25B4%25EB%25B3%25BC-%25EC%2588%2598-%25EC%259E%2588%25EB%258A%2594-%25EA%25B2%25831-%25EC%2584%259C%25EB%25B9%2584%25EC%258A%25A4-%25EA%25B3%2584%25EC%25B8%25B5%25EC%259D%2584-%25EC%2584%259C%25EB%25B9%2584%25EC%258A%25A4-%25EA%25B3%2584%25EC%25B8%25B5-%25EB%258B%25B5%25EA%25B2%258C%2F&text=%EC%A7%80%EC%86%8D%20%EC%84%B1%EC%9E%A5%20%EA%B0%80%EB%8A%A5%ED%95%9C%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC%20%EC%9C%84%ED%95%B4%20%EC%8B%9C%EB%8F%84%ED%95%B4%EB%B3%BC%20%EC%88%98%20%EC%9E%88%EB%8A%94%20%EA%B2%83(1)%20-%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EA%B3%84%EC%B8%B5%EC%9D%84%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EA%B3%84%EC%B8%B5%20%EB%8B%B5%EA%B2%8C%20-%20%EC%9D%B4%EC%98%81%EC%88%98%20%EA%B0%9C%EB%B0%9C%20%EB%B8%94%EB%A1%9C%EA%B7%B8" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fyoungsu5582.life%2F%2Fposts%2F%25EC%25A7%2580%25EC%2586%258D-%25EC%2584%25B1%25EC%259E%25A5-%25EA%25B0%2580%25EB%258A%25A5%25ED%2595%259C-%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8%25EB%25A5%25BC-%25EC%259C%2584%25ED%2595%25B4-%25EC%258B%259C%25EB%258F%2584%25ED%2595%25B4%25EB%25B3%25BC-%25EC%2588%2598-%25EC%259E%2588%25EB%258A%2594-%25EA%25B2%25831-%25EC%2584%259C%25EB%25B9%2584%25EC%258A%25A4-%25EA%25B3%2584%25EC%25B8%25B5%25EC%259D%2584-%25EC%2584%259C%25EB%25B9%2584%25EC%258A%25A4-%25EA%25B3%2584%25EC%25B8%25B5-%25EB%258B%25B5%25EA%25B2%258C%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="" data-title-succeed="" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading"></h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/partitioning-in-postgresql/">파티셔닝 톺아보기 in PostgreSQL - 2025-09-07</a><li class="text-truncate lh-lg"> <a href="/posts/ai-tech-usage-summary-thoughts-ko/">개발자라면 꼭 알아야 할 AI 기술 활용법 영상 정리 및 간단한 사담 - 2025-08-20</a><li class="text-truncate lh-lg"> <a href="/posts/%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-Jackson-%EC%84%A4%EC%A0%95%EB%93%A4-%EC%A0%95%EB%A6%AC/">사용하는 Jackson의 설정 및 기능 정리 - 2025-06-17</a><li class="text-truncate lh-lg"> <a href="/posts/%EC%98%88%EC%99%B8-%EA%B9%8A%EA%B2%8C-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0-%EC%98%88%EC%99%B8-%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C-%EB%8D%98%EC%A7%80%EA%B8%B0/">예외 깊게 살펴보기, 예외 동적으로 던지기 - 2025-05-31</a><li class="text-truncate lh-lg"> <a href="/posts/%EC%82%AC%EC%9A%A9%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-ENUM-%EA%B0%92-%EB%8C%80%EC%9D%91,Interface-%ED%86%B5%ED%95%9C-%EC%A4%91%EB%B3%B5-%EC%BD%94%EB%93%9C-%EC%A0%9C%EA%B1%B0/">사용하지 않는 ENUM 값 대응 , Interface 를 통한 중복 코드 제거 - 2025-05-26</a></ul></section><section><h2 class="panel-heading"></h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9A%B0%ED%85%8C%EC%BD%94/">우테코</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%8A%A4%ED%94%84%EB%A7%81/">스프링</a> <a class="post-tag btn btn-outline-primary" href="/tags/%ED%9A%8C%EA%B3%A0/">회고</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EA%B9%83%ED%97%88%EB%B8%8C/">깃허브</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9E%90%EB%B0%94/">자바</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EA%B9%83/">깃</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%BD%94%ED%8B%80%EB%A6%B0/">코틀린</a> <a class="post-tag btn btn-outline-primary" href="/tags/%ED%85%8C%EC%8A%A4%ED%8A%B8/">테스트</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0"></h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label"></h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81-vs-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%A1%9C%EC%A7%81/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1719546929" data-df="DD/MM/YYYY" > 28/06/2024 </time><h4 class="pt-0 my-2">비즈니스 로직 vs 도메인 로직?</h4><div class="text-muted"><p>꽤나 아리송하다.도메인 로직은 뭐고, 비즈니스 로직은 뭘까?도메인 로직은 간단한 도메인이 실행하는 로직, 비즈니스 로직은 서비스내 메소드 처럼 더 큰 로직 아니야?다른 사람들은 모르겠으나, 나는 이렇게 생각하고 있었다.그러면포인트를 계산해서 적립하는 코드는?달러 -></p></div></div></a></article><article class="col"> <a href="/posts/%EB%AA%85%EC%84%B8%EB%A5%BC-%ED%95%A0%EB%95%8C-Controller%EC%9D%98-%EC%97%AD%ED%99%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EC%9E%90/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1718170187" data-df="DD/MM/YYYY" > 12/06/2024 </time><h4 class="pt-0 my-2">명세를 할때 Controller의 역활 분리하자</h4><div class="text-muted"><p>언터페이스를 통해 Controller 역활 덜어내기</p></div></div></a></article><article class="col"> <a href="/posts/%EC%9E%90%EB%B0%94-%EB%A6%AC%ED%94%8C%EB%A0%89%EC%85%98-%EC%96%B4%EB%94%94-%EA%B9%8C%EC%A7%80-%EA%B0%80%EB%8A%A5%ED%95%A0%EA%B9%8C/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1723734765" data-df="DD/MM/YYYY" > 16/08/2024 </time><h4 class="pt-0 my-2">자바 리플렉션 어디 까지 가능할까</h4><div class="text-muted"><p>PR 올리기 전 내 모든 메소드가 쿼리를 몇 번 실행 하는지 검사 & 리포트를 가능하게</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/PR-%EB%B3%91%ED%95%A9%EB%95%8C-%EC%95%8C%EB%A6%BC-%EB%B0%9B%EB%8A%94-%EB%82%B4%EC%9A%A9%EC%9D%84-%EC%9D%98%EB%AF%B8%EC%9E%88%EA%B2%8C-with-naver-pr-stats-%EC%9B%8C%ED%81%AC%ED%94%8C%EB%A1%9C%EC%9A%B0/" class="btn btn-outline-primary" aria-label="" ><p>PR 병합때 알림 받는 내용을 의미있게 with naver pr stats 워크플로우</p></a> <a href="/posts/%EC%84%9C%EB%B2%84%EA%B0%80-%EB%B0%B0%ED%8F%AC%EB%90%98%EB%A9%B4-%EC%8A%AC%EB%9E%99%EC%9C%BC%EB%A1%9C-%EB%B0%B0%ED%8F%AC-%EA%B2%B0%EA%B3%BC%EC%99%80-%EB%B0%B0%ED%8F%AC%ED%95%9C-%EC%BB%A4%EB%B0%8B%EA%B9%8C%EC%A7%80-with-AWS-CodePipeline/" class="btn btn-outline-primary" aria-label="" ><p>서버가 배포되면, 슬랙으로 배포 결과와 배포한 커밋까지? with AWS CodePipeline</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/youngsu5582">이영수</a>.</p><p></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading"></h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9A%B0%ED%85%8C%EC%BD%94/">우테코</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%8A%A4%ED%94%84%EB%A7%81/">스프링</a> <a class="post-tag btn btn-outline-primary" href="/tags/%ED%9A%8C%EA%B3%A0/">회고</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EA%B9%83%ED%97%88%EB%B8%8C/">깃허브</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9E%90%EB%B0%94/">자바</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EA%B9%83/">깃</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%BD%94%ED%8B%80%EB%A6%B0/">코틀린</a> <a class="post-tag btn btn-outline-primary" href="/tags/%ED%85%8C%EC%8A%A4%ED%8A%B8/">테스트</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'ko';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'youngsu5582/blog', 'data-repo-id': 'R_kgDOOI2eig', 'data-category': 'Post', 'data-category-id': 'DIC_kwDOOI2eis4Cob3Y', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
